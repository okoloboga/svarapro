# üêõ –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–û–ë–õ–ï–ú

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (–ò–°–ü–†–ê–í–ò–¢–¨ –°–†–û–ß–ù–û)

### üî• –ü–†–û–ë–õ–ï–ú–ê 1: –ù–ï–ü–†–ê–í–ò–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê ALL-IN –ß–ï–†–ï–ó RAISE
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–°—Ç–∞—Ç—É—Å**: –ê–ö–¢–ò–í–ù–ê - –ò–ì–†–ê –ó–ê–í–ï–†–®–ê–ï–¢–°–Ø –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û

#### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **All-in —á–µ—Ä–µ–∑ raise –∑–∞–≤–µ—Ä—à–∞–µ—Ç –∏–≥—Ä—É –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ**: –ö–æ–≥–¥–∞ –∏–≥—Ä–æ–∫ –¥–µ–ª–∞–µ—Ç `raise -> max` (all-in), –∏–≥—Ä–∞ —Å—Ä–∞–∑—É –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —è–∫–æ—Ä—å**: –ò–≥—Ä–æ–∫, —Å–¥–µ–ª–∞–≤—à–∏–π all-in —á–µ—Ä–µ–∑ raise, —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —è–∫–æ—Ä–µ–º, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–º—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é
3. **–ù–∞—Ä—É—à–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –í–∞-–ë–∞–Ω–∫**: –î—Ä—É–≥–∏–µ –∏–≥—Ä–æ–∫–∏ –Ω–µ –ø–æ–ª—É—á–∞—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ all-in

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞:
**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —è–∫–æ—Ä—è –¥–ª—è all-in —á–µ—Ä–µ–∑ raise:**

```typescript
// ‚ùå –ü–†–û–ë–õ–ï–ú–ê: lastRaiseIndex —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –¥–ª—è all-in —á–µ—Ä–µ–∑ raise
gameState.lastRaiseIndex = playerIndex; // –ò–≥—Ä–æ–∫ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —è–∫–æ—Ä–µ–º

// ‚ùå –ü–†–û–ë–õ–ï–ú–ê: —è–∫–æ—Ä–µ–º —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç–æ—Ç –∂–µ –∏–≥—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–π —Å–¥–µ–ª–∞–ª all-in
if (gameState.lastRaiseIndex !== undefined) {
  anchorPlayerIndex = gameState.lastRaiseIndex; // –•–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ all-in –∏–≥—Ä–æ–∫—É
}

// ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ —Ö–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ all-in –∏–≥—Ä–æ–∫—É
if (aboutToActPlayerIndex === anchorPlayerIndex) {
  await this.endBettingRound(roomId, gameState); // –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è!
}
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:
1. **–ò–≥—Ä–æ–∫ 1**: –±–∞–ª–∞–Ω—Å 10
2. **–ò–≥—Ä–æ–∫ 2**: –±–∞–ª–∞–Ω—Å 5  
3. **–ò–≥—Ä–æ–∫ 2** –¥–µ–ª–∞–µ—Ç `raise -> max` (all-in –Ω–∞ 5)
4. **–ò–≥—Ä–æ–∫ 1** –ù–ï –ø–æ–ª—É—á–∞–µ—Ç —Ö–æ–¥ - –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è
5. **–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**: –ò–≥—Ä–æ–∫ 1 –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å —Ö–æ–¥ –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å

#### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ GEMINI.md:
1. **All-in —á–µ—Ä–µ–∑ raise** –¥–æ–ª–∂–µ–Ω —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å `isAllIn = true`
2. **–ù–ï —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å** `lastRaiseIndex` (–∏–≥—Ä–æ–∫ –Ω–µ –º–æ–∂–µ—Ç –±–æ–ª—å—à–µ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å)
3. **–ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∏–≥—Ä—É** —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏
4. **–ó–∞–≤–µ—Ä—à–∞—Ç—å –∏–≥—Ä—É** —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —Ö–æ–¥ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –∏–≥—Ä–æ–∫—É —Å –±–∞–ª–∞–Ω—Å–æ–º 0

#### –§–∞–π–ª—ã —Å –ø—Ä–æ–±–ª–µ–º–æ–π:
- `server/src/modules/game/services/game.service.ts:827` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ lastRaiseIndex –¥–ª—è all-in
- `server/src/modules/game/services/game.service.ts:881-887` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∫–æ—Ä—è
- `server/src/modules/game/services/game.service.ts:890-891` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫—Ä—É–≥–∞

#### –†–µ—à–µ–Ω–∏–µ:
1. **–ü—Ä–æ–≤–µ—Ä—è—Ç—å all-in –≤ raise**: `const isAllInRaise = raiseAmount >= player.balance`
2. **–ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å lastRaiseIndex** –¥–ª—è all-in —á–µ—Ä–µ–∑ raise
3. **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å isAllIn = true** –¥–ª—è all-in —á–µ—Ä–µ–∑ raise
4. **–ò—Å–∫–ª—é—á–∞—Ç—å all-in –∏–≥—Ä–æ–∫–æ–≤** –∏–∑ —è–∫–æ—Ä–µ–π
5. **–ü—Ä–æ–≤–µ—Ä—è—Ç—å –±–∞–ª–∞–Ω—Å** –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –∫—Ä—É–≥–∞

#### –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```typescript
// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ all-in –≤ raise
const isAllInRaise = raiseAmount >= player.balance;

// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 2: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º lastRaiseIndex —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ù–ï all-in
if (!isAllInRaise) {
  gameState.lastRaiseIndex = playerIndex;
}

// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 3: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º isAllIn –¥–ª—è all-in —á–µ—Ä–µ–∑ raise
if (isAllInRaise) {
  gameState.players[playerIndex] = this.playerService.updatePlayerStatus(
    updatedPlayer,
    { 
      isAllIn: true,
      hasLookedAndMustAct: false 
    },
  );
}

// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 4: –ò—Å–∫–ª—é—á–∞–µ–º all-in –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ —è–∫–æ—Ä–µ–π
if (gameState.lastRaiseIndex !== undefined) {
  const lastRaisePlayer = gameState.players[gameState.lastRaiseIndex];
  if (!lastRaisePlayer.isAllIn) {
    anchorPlayerIndex = gameState.lastRaiseIndex;
  }
}

// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 5: –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º
if (aboutToActPlayerIndex === anchorPlayerIndex) {
  const nextPlayer = gameState.players[aboutToActPlayerIndex];
  if (nextPlayer.balance === 0 || nextPlayer.isAllIn) {
    await this.endBettingRound(roomId, gameState);
  } else {
    gameState.currentPlayerIndex = aboutToActPlayerIndex;
  }
}
```

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô** - –Ω–∞—Ä—É—à–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É –∏–≥—Ä—ã –í–∞-–ë–∞–Ω–∫

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### üîß –ü–†–û–ë–õ–ï–ú–ê 2: –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï WEBSOCKET –°–û–û–ë–©–ï–ù–ò–ô
**–°—Ç–∞—Ç—É—Å**: –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ

#### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `client.id` –≤–º–µ—Å—Ç–æ `telegramId`
2. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞** —Å timestamp
3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –æ—á–∏—Å—Ç–∫–∞** —Ç–∞–π–º–µ—Ä–æ–≤

### üîß –ü–†–û–ë–õ–ï–ú–ê 3: –°–õ–û–ñ–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê
**–°—Ç–∞—Ç—É—Å**: –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ

#### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. **–ó–∞–º–µ–Ω–µ–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –Ω–∞ –º–æ–Ω–æ–ª–∏—Ç–Ω—É—é
2. **–£–¥–∞–ª–µ–Ω–æ 7 –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤** - –æ—Å—Ç–∞–≤–ª–µ–Ω 1 GameService
3. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ç–∞–π–º–µ—Ä–æ–≤** –≤ –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å
4. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∞–π–º–µ—Ä–µ** –∫–ª–∏–µ–Ω—Ç—É

### üîß –ü–†–û–ë–õ–ï–ú–ê 4: –û–¢–°–£–¢–°–¢–í–ò–ï –¢–ê–ô–ú–ï–†–û–í
**–°—Ç–∞—Ç—É—Å**: –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ

#### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. **–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–π–º–µ—Ä—ã** –≤ –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π GameService
2. **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–π–º–µ—Ä–µ** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ GameState
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fold** –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
4. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞** —Ç–∞–π–º–µ—Ä–æ–≤ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏–≥—Ä—ã
