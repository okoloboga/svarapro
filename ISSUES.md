# üêõ –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–û–ë–õ–ï–ú

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (–ò–°–ü–†–ê–í–ò–¢–¨ –°–†–û–ß–ù–û)

### üî• –ü–†–û–ë–õ–ï–ú–ê 0: –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –î–ï–ô–°–¢–í–ò–ô –í WEBSOCKET
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–°—Ç–∞—Ç—É—Å**: –ê–ö–¢–ò–í–ù–ê - –ó–ê–©–ò–¢–ê –ù–ï –†–ê–ë–û–¢–ê–ï–¢

#### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket —Å–æ–æ–±—â–µ–Ω–∏–π**: –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–≥—Ä–æ–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è **–î–í–ê–ñ–î–´** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç**: –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `[DUPLICATE_ACTION_BLOCKED]`
3. **Look -> Raise/Call –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ**: –ò–∑-–∑–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ö–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Ç–æ–º—É –∂–µ –∏–≥—Ä–æ–∫—É

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞:
**–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞:**

```typescript
// –¢–µ–∫—É—â–∞—è –∑–∞—â–∏—Ç–∞ (–ù–ï –†–ê–ë–û–¢–ê–ï–¢):
const simpleKey = `${roomId}-${telegramId}-${action}-${amount}`;
// –ü—Ä–æ–±–ª–µ–º–∞: amount –º–æ–∂–µ—Ç –±—ã—Ç—å undefined, –∫–ª—é—á –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–ª—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

// –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:
[WEBSOCKET_DEBUG] Received game_action from client cIwhpFexW_NGkiWiAAAJ, telegramId 5101525651, roomId 0001, action look, amount undefined
[WEBSOCKET_DEBUG] Received game_action from client cIwhpFexW_NGkiWiAAAJ, telegramId 5101525651, roomId 0001, action look, amount undefined  ‚Üê –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï!
```

#### –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**: 
   - WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è
   - –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã
   - –°–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –¥–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è

2. **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç**:
   - –ö–ª—é—á –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–ª—è –æ–±–æ–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
   - `amount = undefined` –≤ –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö
   - –í—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –∑–∞—â–∏—Ç—É

3. **–†–µ–∑—É–ª—å—Ç–∞—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**:
   - –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã
   - –•–æ–¥ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–≥—Ä–æ–∫—É –¥–≤–∞–∂–¥—ã
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∏–≥—Ä–æ–∫—É
   - **Look -> Raise/Call –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ**

#### –§–∞–π–ª—ã —Å –ø—Ä–æ–±–ª–µ–º–æ–π:
- `server/src/modules/game/game.gateway.ts:139-145` - –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- `client/src/App.tsx:224-246` - –í–æ–∑–º–æ–∂–Ω–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- `client/src/services/websocket.ts:15-75` - WebSocket –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

#### –†–µ—à–µ–Ω–∏–µ:
1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–ª—é—á –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `client.id` –≤–º–µ—Å—Ç–æ `telegramId`:
   ```typescript
   const clientKey = `${client.id}-${action}-${amount || 'null'}`;
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å timestamp –≤ –∫–ª—é—á** - –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π –∑–∞—â–∏—Ç—ã:
   ```typescript
   const actionKey = `${client.id}-${action}-${Date.now()}`;
   ```

3. **–£–º–µ–Ω—å—à–∏—Ç—å –≤—Ä–µ–º—è –æ—á–∏—Å—Ç–∫–∏** - —Å 1000ms –¥–æ 500ms:
   ```typescript
   setTimeout(() => {
     this.processingActions.delete(clientKey);
   }, 500);
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª–∏–µ–Ω—Ç** - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ WebSocket –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è

#### –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- `[WEBSOCKET_DEBUG]` - –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- `[DUPLICATE_ACTION_BLOCKED]` - –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- `[PROCESS_ACTION_DEBUG]` - –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
- `[GAME_ACTION_DEBUG]` - –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ GameActionService

#### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:
**–ü—Ä–æ–±–ª–µ–º–∞ –≤ –∑–∞—â–∏—Ç–µ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:**

```typescript
// –¢–µ–∫—É—â–∞—è –∑–∞—â–∏—Ç–∞ (–ù–ï –†–ê–ë–û–¢–ê–ï–¢):
const simpleKey = `${roomId}-${telegramId}-${action}-${amount}`;
// –ü—Ä–æ–±–ª–µ–º–∞: amount = undefined, –∫–ª—é—á –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–ª—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

// –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:
[WEBSOCKET_DEBUG] Received game_action from client cIwhpFexW_NGkiWiAAAJ, telegramId 5101525651, roomId 0001, action look, amount undefined
[WEBSOCKET_DEBUG] Received game_action from client cIwhpFexW_NGkiWiAAAJ, telegramId 5101525651, roomId 0001, action look, amount undefined  ‚Üê –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï!
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å:**
```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å client.id –≤–º–µ—Å—Ç–æ telegramId:
const clientKey = `${client.id}-${action}-${amount || 'null'}`;

// –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å timestamp:
const actionKey = `${client.id}-${action}-${Date.now()}`;
```

#### –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ (–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û):
**–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket —Å–æ–æ–±—â–µ–Ω–∏–π:**
```
[WEBSOCKET_DEBUG] Received game_action from client cIwhpFexW_NGkiWiAAAJ, telegramId 5101525651, roomId 0001, action look, amount undefined
[WEBSOCKET_DEBUG] Received game_action from client cIwhpFexW_NGkiWiAAAJ, telegramId 5101525651, roomId 0001, action look, amount undefined  ‚Üê –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï!
```
**–ü–†–û–ë–õ–ï–ú–ê**: –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç **–î–í–ê–ñ–î–´** - –∑–∞—â–∏—Ç–∞ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç!

**–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
// –ù–ï–¢ –õ–û–ì–û–í [DUPLICATE_ACTION_BLOCKED] - –∑–∞—â–∏—Ç–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!
```
**–ü–†–û–ë–õ–ï–ú–ê**: –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ—Ö–æ–¥—è—Ç –¥–≤–∞–∂–¥—ã!

#### –°—Ü–µ–Ω–∞—Ä–∏–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:
1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π**: –õ—é–±–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–≥—Ä–æ–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã –∏–∑-–∑–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö WebSocket —Å–æ–æ–±—â–µ–Ω–∏–π
2. **Look -> Raise –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ**: –ò–≥—Ä–æ–∫ –¥–µ–ª–∞–µ—Ç `look` ‚Üí `raise`, –Ω–æ –∏–∑-–∑–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ö–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –Ω–µ–º—É
3. **Look -> Call –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞**: –ò–≥—Ä–æ–∫ –¥–µ–ª–∞–µ—Ç `look` ‚Üí `call`, –Ω–æ –∏–∑-–∑–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏–≥—Ä–∞ –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç –≤ `blind_betting`

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô** - –∏–≥—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–∞ –∏–∑-–∑–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π

#### –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–ª—é—á –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** - –≤ `GameGateway.handleGameAction()`:
   ```typescript
   // ‚ùå –¢–ï–ö–£–©–ò–ô (–ù–ï –†–ê–ë–û–¢–ê–ï–¢):
   const simpleKey = `${roomId}-${telegramId}-${action}-${amount}`;
   
   // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô:
   const clientKey = `${client.id}-${action}-${amount || 'null'}`;
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å timestamp –≤ –∫–ª—é—á** - –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π –∑–∞—â–∏—Ç—ã:
   ```typescript
   const actionKey = `${client.id}-${action}-${Date.now()}`;
   ```

3. **–£–º–µ–Ω—å—à–∏—Ç—å –≤—Ä–µ–º—è –æ—á–∏—Å—Ç–∫–∏** - —Å 1000ms –¥–æ 500ms:
   ```typescript
   setTimeout(() => {
     this.processingActions.delete(clientKey);
   }, 500);
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª–∏–µ–Ω—Ç** - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ WebSocket –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### üîß –ü–†–û–ë–õ–ï–ú–ê 1: –î–í–û–ô–ù–û–ï WEBSOCKET –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –í –ö–õ–ò–ï–ù–¢–ï
**–°—Ç–∞—Ç—É—Å**: –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ

#### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. **–£–±—Ä–∞–Ω–æ –¥–≤–æ–π–Ω–æ–µ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** –≤ `App.tsx`
2. **–û–±—ä–µ–¥–∏–Ω–µ–Ω–∞ WebSocket –ª–æ–≥–∏–∫–∞** –≤ `websocket.ts` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –±–∞–ª–∞–Ω—Å–∞
3. **–î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–∞–ª–∞–Ω—Å–∞** —á–µ—Ä–µ–∑ CustomEvent –¥–ª—è —Å–≤—è–∑–∏ —Å App.tsx
4. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç

#### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `client/src/App.tsx` - —É–±—Ä–∞–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ `socketInstance`
- `client/src/services/websocket.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–∞–ª–∞–Ω—Å–∞

### üîß –ü–†–û–ë–õ–ï–ú–ê 2: –û–®–ò–ë–ö–ê TYPESCRIPT –í USERDATA
**–°—Ç–∞—Ç—É—Å**: –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ

#### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
```typescript
// ‚ùå –ë–´–õ–û:
avatar: profile.avatar || '',

// ‚úÖ –°–¢–ê–õ–û:
photo_url: profile.avatar || '',
```

#### –ü—Ä–∏—á–∏–Ω–∞:
–í —Ç–∏–ø–µ `UserData` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –ø–æ–ª–µ `photo_url`, –∞ –Ω–µ `avatar`

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (–ò–°–ü–†–ê–í–ò–¢–¨ –°–†–û–ß–ù–û)
